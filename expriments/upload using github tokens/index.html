<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File to GitHub</title>
    <style>
        #progressWrapper {
            display: none;
            margin-top: 20px;
        }
        #progressBar {
            width: 100%;
            background-color: #f3f3f3;
            height: 30px;
        }
        #progressBarFill {
            width: 0;
            height: 100%;
            background-color: #4caf50;
        }
        #progressPercentage {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: white;
        }
        body{
            background-color: wheat;
            text-align: center;
        }
    </style>
</head>
<body>
    <h2>Upload File to GitHub</h2>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>
    <div id="progressWrapper">
        <div id="progressBar">
            <div id="progressBarFill"></div>
        </div>
        <div id="progressPercentage">0%</div>
    </div>
    <script>
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert("Please select a file first.");
                return;
            }
            
            const progressWrapper = document.getElementById('progressWrapper');
            progressWrapper.style.display = 'block';
            
            const repoOwner = 'YOUR_GITHUB_USERNAME';
            const repoName = 'YOUR_REPOSITORY_NAME';
            const branch = 'main';
            const filePath = file.name;
            const token = 'YOUR_GITHUB_TOKEN';
            const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

            try {
                const content = await readFileAsBase64(file);
                await uploadToGitHub(apiUrl, token, branch, file.name, content, updateProgress);
                alert("File uploaded successfully!");
            } catch (error) {
                console.error("Error:", error);
                alert("An error occurred during the upload.");
            } finally {
                setTimeout(() => {
                    progressWrapper.style.display = 'none';
                    document.getElementById('progressBarFill').style.width = '0%';
                    document.getElementById('progressPercentage').textContent = '0%';
                }, 2000);
            }
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function uploadToGitHub(url, token, branch, fileName, content, progressCallback) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('PUT', url, true);
                xhr.setRequestHeader('Authorization', `token ${token}`);
                xhr.setRequestHeader('Content-Type', 'application/json');

                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        const percentComplete = Math.round((event.loaded / event.total) * 100);
                        progressCallback(percentComplete);
                    }
                };

                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        resolve(xhr.response);
                    } else {
                        reject(new Error(`HTTP error! status: ${xhr.status}`));
                    }
                };

                xhr.onerror = function() {
                    reject(new Error('Network error occurred'));
                };

                const data = JSON.stringify({
                    message: `Add ${fileName}`,
                    content: content,
                    branch: branch
                });

                xhr.send(data);
            });
        }

        function updateProgress(percentage) {
            const progressBarFill = document.getElementById('progressBarFill');
            const progressPercentage = document.getElementById('progressPercentage');
            progressBarFill.style.width = percentage + '%';
            progressPercentage.textContent = percentage + '%';
        }
    </script>
</body>
</html>